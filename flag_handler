#!/bin/bash

# deal with the flags

# possible flags:
# -f pattern for files
# -t pattern for tests
# -e pattern for expected
# -d project directory
# -j for tests in json

# finished flags:
# -c for compiler
# -a for adding flags
# -r :flag: for remove a flag
# -r for removing all flags
# -l for listing the flags
# -h for help


proj_dir="$HOME/.gradescope"
defaults="$HOME/.defaults"
#get the default compiler and flags
compiler=$(grep "compiler: " "$defaults" | sed 's/compiler: //') 
flags=$(grep "^flag:" "$defaults" | awk '{print substr($0, index($0,$2))}')

while getopts "c:rr:a:hl" opt; do
  case $opt in
    c)
      compiler="$OPTARG"
      ;;
    a)
      echo "flag: $OPTARG" >> "$defaults" #remove the \n
      flags=$(grep "^flag:" "$defaults" | awk '{print substr($0, index($0,$2))}')
      echo "$flags"
      ;;
    r)
      if [ "$OPTARG" ]; then
        echo "remove a single flag"
      else
        flags=""
      fi
      ;;
    l)
      echo "$flags"
      ;;
    h)
      echo "help yourself"
      ;;
    \?)
      echo "Invalid option: -$OPTARG" >&2
      exit 1
      ;;
  esac
done

# save the compiler and flags
echo "compiler: $compiler" > "$defaults"
for flag in "$flags"; do
  printf "flag: %s\n" "$flag" >> "$defaults"
  echo "i hate myself"
done
